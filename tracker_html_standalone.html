<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Research Project Tracker</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useRef } = React;

        // Lucide icons as SVG components
        const Check = ({ size = 24, color = "currentColor" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polyline points="20 6 9 17 4 12"></polyline>
            </svg>
        );

        const Plus = ({ size = 24, color = "currentColor" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
        );

        const Trash2 = ({ size = 24, color = "currentColor" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polyline points="3 6 5 6 21 6"></polyline>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                <line x1="10" y1="11" x2="10" y2="17"></line>
                <line x1="14" y1="11" x2="14" y2="17"></line>
            </svg>
        );

        const ChevronDown = ({ size = 24, color = "currentColor" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polyline points="6 9 12 15 18 9"></polyline>
            </svg>
        );

        const ChevronRight = ({ size = 24, color = "currentColor" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polyline points="9 18 15 12 9 6"></polyline>
            </svg>
        );

        const ChevronUp = ({ size = 24, color = "currentColor" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polyline points="18 15 12 9 6 15"></polyline>
            </svg>
        );

        const Edit2 = ({ size = 24, color = "currentColor" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path>
            </svg>
        );

        const X = ({ size = 24, color = "currentColor" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
        );

        function App() {
            const [projects, setProjects] = useState([
                {
                    id: 1,
                    name: 'Current Semester Objectives',
                    tasks: [
                        { id: 1, title: 'Acoustic project 25% (±5%)', completed: false, notes: '', images: [], connections: [], subtasks: [], expanded: true },
                        { id: 2, title: 'Surface project 20%', completed: false, notes: '', images: [], connections: [], subtasks: [], expanded: true },
                        { id: 3, title: 'Microrobot ⅓$ (±5%)', completed: false, notes: '', images: [], connections: [], subtasks: [], expanded: true }
                    ]
                }
            ]);

            const [selectedTask, setSelectedTask] = useState(null);
            const [newProjectName, setNewProjectName] = useState('');
            const [editingProject, setEditingProject] = useState(null);
            const fileInputRef = useRef(null);

            const moveProjectUp = (projectId) => {
                const index = projects.findIndex(p => p.id === projectId);
                if (index > 0) {
                    const newProjects = [...projects];
                    [newProjects[index - 1], newProjects[index]] = [newProjects[index], newProjects[index - 1]];
                    setProjects(newProjects);
                }
            };

            const moveProjectDown = (projectId) => {
                const index = projects.findIndex(p => p.id === projectId);
                if (index < projects.length - 1) {
                    const newProjects = [...projects];
                    [newProjects[index], newProjects[index + 1]] = [newProjects[index + 1], newProjects[index]];
                    setProjects(newProjects);
                }
            };

            const addProject = () => {
                if (newProjectName.trim()) {
                    setProjects([...projects, {
                        id: Date.now(),
                        name: newProjectName,
                        tasks: []
                    }]);
                    setNewProjectName('');
                }
            };

            const addTask = (projectId) => {
                setProjects(projects.map(p =>
                    p.id === projectId
                        ? { ...p, tasks: [...p.tasks, { id: Date.now(), title: 'New Task', completed: false, notes: '', images: [], connections: [], subtasks: [], expanded: true }] }
                        : p
                ));
            };

            const addSubtask = (projectId, parentPath) => {
                setProjects(projects.map(p => {
                    if (p.id === projectId) {
                        const newTask = { id: Date.now(), title: 'New Subtask', completed: false, notes: '', images: [], connections: [], subtasks: [], expanded: true };
                        return { ...p, tasks: addSubtaskRecursive(p.tasks, parentPath, newTask) };
                    }
                    return p;
                }));
            };

            const addSubtaskRecursive = (tasks, path, newTask) => {
                if (path.length === 1) {
                    return tasks.map(t =>
                        t.id === path[0] ? { ...t, subtasks: [...t.subtasks, newTask], expanded: true } : t
                    );
                }
                return tasks.map(t =>
                    t.id === path[0] ? { ...t, subtasks: addSubtaskRecursive(t.subtasks, path.slice(1), newTask) } : t
                );
            };

            const toggleTask = (projectId, path) => {
                setProjects(projects.map(p =>
                    p.id === projectId ? { ...p, tasks: toggleTaskRecursive(p.tasks, path) } : p
                ));
            };

            const toggleTaskRecursive = (tasks, path) => {
                if (path.length === 1) {
                    return tasks.map(t => {
                        if (t.id === path[0]) {
                            const newCompleted = !t.completed;
                            return { ...t, completed: newCompleted, subtasks: setAllSubtasksCompleted(t.subtasks, newCompleted) };
                        }
                        return t;
                    });
                }
                return tasks.map(t =>
                    t.id === path[0] ? { ...t, subtasks: toggleTaskRecursive(t.subtasks, path.slice(1)) } : t
                );
            };

            const setAllSubtasksCompleted = (subtasks, completed) => {
                return subtasks.map(st => ({
                    ...st,
                    completed,
                    subtasks: setAllSubtasksCompleted(st.subtasks, completed)
                }));
            };

            const toggleExpanded = (projectId, path) => {
                setProjects(projects.map(p =>
                    p.id === projectId ? { ...p, tasks: toggleExpandedRecursive(p.tasks, path) } : p
                ));
            };

            const toggleExpandedRecursive = (tasks, path) => {
                if (path.length === 1) {
                    return tasks.map(t => t.id === path[0] ? { ...t, expanded: !t.expanded } : t);
                }
                return tasks.map(t =>
                    t.id === path[0] ? { ...t, subtasks: toggleExpandedRecursive(t.subtasks, path.slice(1)) } : t
                );
            };

            const deleteTask = (projectId, path) => {
                setProjects(projects.map(p =>
                    p.id === projectId ? { ...p, tasks: deleteTaskRecursive(p.tasks, path) } : p
                ));
            };

            const deleteTaskRecursive = (tasks, path) => {
                if (path.length === 1) {
                    return tasks.filter(t => t.id !== path[0]);
                }
                return tasks.map(t =>
                    t.id === path[0] ? { ...t, subtasks: deleteTaskRecursive(t.subtasks, path.slice(1)) } : t
                );
            };

            const updateTaskTitle = (projectId, path, newTitle) => {
                setProjects(projects.map(p =>
                    p.id === projectId ? { ...p, tasks: updateTaskTitleRecursive(p.tasks, path, newTitle) } : p
                ));
            };

            const updateTaskTitleRecursive = (tasks, path, newTitle) => {
                if (path.length === 1) {
                    return tasks.map(t => t.id === path[0] ? { ...t, title: newTitle } : t);
                }
                return tasks.map(t =>
                    t.id === path[0] ? { ...t, subtasks: updateTaskTitleRecursive(t.subtasks, path.slice(1), newTitle) } : t
                );
            };

            const updateTaskNotes = (projectId, path, notes) => {
                setProjects(projects.map(p =>
                    p.id === projectId ? { ...p, tasks: updateTaskNotesRecursive(p.tasks, path, notes) } : p
                ));
            };

            const updateTaskNotesRecursive = (tasks, path, notes) => {
                if (path.length === 1) {
                    return tasks.map(t => t.id === path[0] ? { ...t, notes } : t);
                }
                return tasks.map(t =>
                    t.id === path[0] ? { ...t, subtasks: updateTaskNotesRecursive(t.subtasks, path.slice(1), notes) } : t
                );
            };

            const handleImageUpload = (projectId, path, e) => {
                const files = Array.from(e.target.files);
                files.forEach(file => {
                    const reader = new FileReader();
                    reader.onloadend = () => {
                        setProjects(prev => prev.map(p =>
                            p.id === projectId ? { ...p, tasks: addImageRecursive(p.tasks, path, reader.result) } : p
                        ));
                    };
                    reader.readAsDataURL(file);
                });
            };

            const addImageRecursive = (tasks, path, image) => {
                if (path.length === 1) {
                    return tasks.map(t => t.id === path[0] ? { ...t, images: [...t.images, image] } : t);
                }
                return tasks.map(t =>
                    t.id === path[0] ? { ...t, subtasks: addImageRecursive(t.subtasks, path.slice(1), image) } : t
                );
            };

            const removeImage = (projectId, path, imageIndex) => {
                setProjects(projects.map(p =>
                    p.id === projectId ? { ...p, tasks: removeImageRecursive(p.tasks, path, imageIndex) } : p
                ));
            };

            const removeImageRecursive = (tasks, path, imageIndex) => {
                if (path.length === 1) {
                    return tasks.map(t => t.id === path[0] ? { ...t, images: t.images.filter((_, i) => i !== imageIndex) } : t);
                }
                return tasks.map(t =>
                    t.id === path[0] ? { ...t, subtasks: removeImageRecursive(t.subtasks, path.slice(1), imageIndex) } : t
                );
            };

            const calculateProgress = (projectId) => {
                const project = projects.find(p => p.id === projectId);
                if (!project || project.tasks.length === 0) return 0;
                const { completed, total } = countTasksRecursive(project.tasks);
                return total === 0 ? 0 : Math.round((completed / total) * 100);
            };

            const countTasksRecursive = (tasks) => {
                let completed = 0;
                let total = 0;
                tasks.forEach(t => {
                    total++;
                    if (t.completed) completed++;
                    if (t.subtasks.length > 0) {
                        const sub = countTasksRecursive(t.subtasks);
                        completed += sub.completed;
                        total += sub.total;
                    }
                });
                return { completed, total };
            };

            const renderTask = (task, projectId, path, depth = 0) => {
                const hasSubtasks = task.subtasks && task.subtasks.length > 0;

                const getBackgroundColor = (depth) => {
                    const colors = [
                        'rgb(18, 18, 18)',
                        'rgb(60, 60, 60)',
                        'rgb(225, 229, 231)',
                    ];
                    return colors[depth % 3];
                };

                const bgColor = getBackgroundColor(depth);
                const isLightBg = depth % 3 === 2;

                return (
                    <div key={task.id} style={{ marginBottom: '8px' }}>
                        <div
                            style={{
                                marginLeft: `${depth * 20}px`,
                                backgroundColor: bgColor,
                                borderRadius: '8px',
                                padding: '12px',
                                border: task.completed ? '2px solid rgb(34, 197, 94)' : '2px solid rgb(75, 85, 99)',
                                transition: 'all 0.2s'
                            }}
                        >
                            <div style={{ display: 'flex', alignItems: 'start', gap: '8px', marginBottom: '8px' }}>
                                {hasSubtasks && (
                                    <button
                                        onClick={() => toggleExpanded(projectId, path)}
                                        style={{
                                            flexShrink: 0,
                                            background: 'none',
                                            border: 'none',
                                            cursor: 'pointer',
                                            color: isLightBg ? 'rgb(18, 18, 18)' : 'rgb(225, 229, 231)',
                                            marginTop: '4px',
                                            padding: 0
                                        }}
                                    >
                                        {task.expanded ? <ChevronDown size={16} /> : <ChevronRight size={16} />}
                                    </button>
                                )}
                                <button
                                    onClick={() => toggleTask(projectId, path)}
                                    style={{
                                        flexShrink: 0,
                                        width: '20px',
                                        height: '20px',
                                        borderRadius: '4px',
                                        border: task.completed ? '2px solid rgb(34, 197, 94)' : `2px solid ${isLightBg ? 'rgb(18, 18, 18)' : 'rgb(225, 229, 231)'}`,
                                        backgroundColor: task.completed ? 'rgb(34, 197, 94)' : 'transparent',
                                        display: 'flex',
                                        alignItems: 'center',
                                        justifyContent: 'center',
                                        cursor: 'pointer',
                                        transition: 'all 0.2s',
                                        padding: 0
                                    }}
                                >
                                    {task.completed && <Check size={14} color="white" />}
                                </button>
                                <input
                                    type="text"
                                    value={task.title}
                                    onChange={(e) => updateTaskTitle(projectId, path, e.target.value)}
                                    style={{
                                        flex: 1,
                                        background: 'transparent',
                                        border: 'none',
                                        outline: 'none',
                                        fontWeight: '500',
                                        fontSize: '14px',
                                        color: task.completed ? 'rgb(156, 163, 175)' : (isLightBg ? 'rgb(18, 18, 18)' : 'rgb(225, 229, 231)'),
                                        textDecoration: task.completed ? 'line-through' : 'none'
                                    }}
                                />
                                <div style={{ display: 'flex', gap: '8px', alignItems: 'start' }}>
                                    <div style={{ flex: 1 }}>
                                        <textarea
                                            value={task.notes}
                                            onChange={(e) => {
                                                updateTaskNotes(projectId, path, e.target.value);
                                                e.target.style.height = 'auto';
                                                e.target.style.height = e.target.scrollHeight + 'px';
                                            }}
                                            onFocus={(e) => {
                                                e.target.style.height = 'auto';
                                                e.target.style.height = e.target.scrollHeight + 'px';
                                            }}
                                            placeholder="Add notes..."
                                            style={{
                                                width: '100%',
                                                border: '1px solid rgb(75, 85, 99)',
                                                borderRadius: '4px',
                                                padding: '8px',
                                                fontSize: '12px',
                                                outline: 'none',
                                                resize: 'none',
                                                overflow: 'hidden',
                                                backgroundColor: isLightBg ? 'rgb(200, 200, 200)' : 'rgb(38, 38, 38)',
                                                color: 'rgb(156, 163, 175)'
                                            }}
                                            rows="1"
                                        />
                                    </div>
                                    <div style={{ display: 'flex', flexDirection: 'column', gap: '4px' }}>
                                        <button
                                            onClick={() => deleteTask(projectId, path)}
                                            style={{
                                                background: 'none',
                                                border: 'none',
                                                cursor: 'pointer',
                                                color: 'rgb(155, 0, 0)',
                                                padding: 0
                                            }}
                                        >
                                            <Trash2 size={14} />
                                        </button>
                                        <button
                                            onClick={() => {
                                                fileInputRef.current?.click();
                                                fileInputRef.current.dataset.projectId = projectId;
                                                fileInputRef.current.dataset.path = JSON.stringify(path);
                                            }}
                                            style={{
                                                background: 'none',
                                                border: 'none',
                                                cursor: 'pointer',
                                                color: isLightBg ? 'rgb(18, 18, 18)' : 'rgb(225, 229, 231)',
                                                padding: 0
                                            }}
                                        >
                                            <svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                                            </svg>
                                        </button>
                                        <button
                                            onClick={() => addSubtask(projectId, path)}
                                            style={{
                                                background: 'none',
                                                border: 'none',
                                                cursor: 'pointer',
                                                color: isLightBg ? 'rgb(18, 18, 18)' : 'rgb(225, 229, 231)',
                                                padding: 0
                                            }}
                                        >
                                            <Plus size={14} />
                                        </button>
                                    </div>
                                </div>
                            </div>

                            {task.images.length > 0 && (
                                <div style={{ display: 'grid', gridTemplateColumns: 'repeat(3, 1fr)', gap: '4px', marginBottom: '8px', marginLeft: '28px', marginRight: '40px' }}>
                                    {task.images.map((img, idx) => (
                                        <div key={idx} style={{ position: 'relative' }}>
                                            <img
                                                src={img}
                                                alt={`Task ${idx + 1}`}
                                                style={{ width: '100%', height: '64px', objectFit: 'cover', borderRadius: '4px', cursor: 'pointer' }}
                                                onClick={() => setSelectedTask({ projectId, path, imageIndex: idx, image: img })}
                                            />
                                            <button
                                                onClick={() => removeImage(projectId, path, idx)}
                                                style={{
                                                    position: 'absolute',
                                                    top: '2px',
                                                    right: '2px',
                                                    backgroundColor: 'rgb(155, 0, 0)',
                                                    borderRadius: '9999px',
                                                    padding: '2px',
                                                    opacity: 0,
                                                    transition: 'opacity 0.2s',
                                                    border: 'none',
                                                    cursor: 'pointer'
                                                }}
                                                onMouseEnter={(e) => e.currentTarget.style.opacity = 1}
                                                onMouseLeave={(e) => e.currentTarget.style.opacity = 0}
                                            >
                                                <X size={10} color="white" />
                                            </button>
                                        </div>
                                    ))}
                                </div>
                            )}
                        </div>

                        {hasSubtasks && task.expanded && (
                            <div style={{ marginTop: '4px' }}>
                                {task.subtasks.map(subtask => renderTask(subtask, projectId, [...path, subtask.id], depth + 1))}
                            </div>
                        )}
                    </div>
                );
            };

            return (
                <div style={{ minHeight: '100vh', backgroundColor: 'rgb(18, 18, 18)', padding: '24px' }}>
                    <div style={{ maxWidth: '1280px', margin: '0 auto' }}>
                        <header style={{ marginBottom: '32px' }}>
                            <h1 style={{ fontSize: '36px', fontWeight: 'bold', marginBottom: '8px', color: 'white' }}>
                                Research Project Tracker
                            </h1>
                            <p style={{ color: 'rgb(156, 163, 175)' }}>Organize your tasks with unlimited subtasks, track progress, and attach images</p>
                        </header>

                        <div style={{ marginBottom: '24px', display: 'flex', gap: '8px' }}>
                            <input
                                type="text"
                                value={newProjectName}
                                onChange={(e) => setNewProjectName(e.target.value)}
                                onKeyPress={(e) => e.key === 'Enter' && addProject()}
                                placeholder="New project name..."
                                style={{
                                    flex: 1,
                                    backgroundColor: 'rgb(38, 38, 38)',
                                    border: '1px solid rgb(75, 85, 99)',
                                    borderRadius: '8px',
                                    padding: '8px 16px',
                                    outline: 'none',
                                    color: 'rgb(225, 229, 231)'
                                }}
                            />
                            <button
                                onClick={addProject}
                                style={{
                                    backgroundColor: 'rgb(155, 0, 0)',
                                    color: 'white',
                                    padding: '8px 16px',
                                    borderRadius: '8px',
                                    display: 'flex',
                                    alignItems: 'center',
                                    gap: '8px',
                                    border: 'none',
                                    cursor: 'pointer',
                                    transition: 'opacity 0.2s'
                                }}
                            >
                                <Plus size={20} /> Add Project
                            </button>
                        </div>

                        <div style={{ display: 'grid', gap: '24px' }}>
                            {projects.map(project => (
                                <div
                                    key={project.id}
                                    style={{
                                        backgroundColor: 'rgb(28, 28, 28)',
                                        borderRadius: '12px',
                                        padding: '24px',
                                        border: '1px solid rgb(75, 85, 99)'
                                    }}
                                >
                                    <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', marginBottom: '16px' }}>
                                        <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                                            <div style={{ display: 'flex', flexDirection: 'column', gap: '4px' }}>
                                                <button
                                                    onClick={() => moveProjectUp(project.id)}
                                                    disabled={projects.findIndex(p => p.id === project.id) === 0}
                                                    style={{
                                                        background: 'none',
                                                        border: 'none',
                                                        cursor: 'pointer',
                                                        color: 'rgb(225, 229, 231)',
                                                        padding: 0
                                                    }}
                                                >
                                                    <ChevronUp size={18} />
                                                </button>
                                                <button
                                                    onClick={() => moveProjectDown(project.id)}
                                                    disabled={projects.findIndex(p => p.id === project.id) === projects.length - 1}
                                                    style={{
                                                        background: 'none',
                                                        border: 'none',
                                                        cursor: 'pointer',
                                                        color: 'rgb(225, 229, 231)',
                                                        padding: 0
                                                    }}
                                                >
                                                    <ChevronDown size={18} />
                                                </button>
                                            </div>
                                            {editingProject === project.id ? (
                                                <input
                                                    type="text"
                                                    value={project.name}
                                                    onChange={(e) => setProjects(projects.map(p => p.id === project.id ? { ...p, name: e.target.value } : p))}
                                                    onBlur={() => setEditingProject(null)}
                                                    onKeyPress={(e) => e.key === 'Enter' && setEditingProject(null)}
                                                    autoFocus
                                                    style={{
                                                        fontSize: '24px',
                                                        fontWeight: 'bold',
                                                        backgroundColor: 'rgb(38, 38, 38)',
                                                        border: '1px solid rgb(75, 85, 99)',
                                                        borderRadius: '4px',
                                                        padding: '4px 8px',
                                                        outline: 'none',
                                                        color: 'rgb(225, 229, 231)'
                                                    }}
                                                />
                                            ) : (
                                                <h2 style={{ fontSize: '24px', fontWeight: 'bold', display: 'flex', alignItems: 'center', gap: '8px', color: 'white', margin: 0 }}>
                                                    {project.name}
                                                    <button
                                                        onClick={() => setEditingProject(project.id)}
                                                        style={{
                                                            background: 'none',
                                                            border: 'none',
                                                            cursor: 'pointer',
                                                            color: 'rgb(225, 229, 231)',
                                                            padding: 0
                                                        }}
                                                    >
                                                        <Edit2 size={18} />
                                                    </button>
                                                </h2>
                                            )}
                                        </div>
                                        <div style={{ display: 'flex', alignItems: 'center', gap: '16px' }}>
                                            <div style={{ textAlign: 'right' }}>
                                                <div style={{ fontSize: '30px', fontWeight: 'bold', color: 'rgb(155, 0, 0)' }}>{calculateProgress(project.id)}%</div>
                                                <div style={{ fontSize: '14px', color: 'rgb(156, 163, 175)' }}>Complete</div>
                                            </div>
                                            <button
                                                onClick={() => addTask(project.id)}
                                                style={{
                                                    backgroundColor: 'rgb(38, 38, 38)',
                                                    padding: '8px',
                                                    borderRadius: '8px',
                                                    border: 'none',
                                                    cursor: 'pointer',
                                                    transition: 'opacity 0.2s'
                                                }}
                                            >
                                                <Plus size={20} color="rgb(225, 229, 231)" />
                                            </button>
                                        </div>
                                    </div>

                                    <div>
                                        {project.tasks.map(task => renderTask(task, project.id, [task.id]))}
                                    </div>
                                </div>
                            ))}
                        </div>

                        <input
                            ref={fileInputRef}
                            type="file"
                            accept="image/*"
                            multiple
                            style={{ display: 'none' }}
                            onChange={(e) => {
                                const projectId = parseInt(e.target.dataset.projectId);
                                const path = JSON.parse(e.target.dataset.path);
                                handleImageUpload(projectId, path, e);
                                e.target.value = '';
                            }}
                        />

                        {selectedTask && (
                            <div
                                style={{
                                    position: 'fixed',
                                    inset: 0,
                                    backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                    display: 'flex',
                                    alignItems: 'center',
                                    justifyContent: 'center',
                                    zIndex: 50,
                                    padding: '16px'
                                }}
                                onClick={() => setSelectedTask(null)}
                            >
                                <div style={{ maxWidth: '1024px', maxHeight: '90vh' }} onClick={e => e.stopPropagation()}>
                                    <img src={selectedTask.image} alt="Full size" style={{ maxWidth: '100%', maxHeight: '90vh', borderRadius: '8px' }} />
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>